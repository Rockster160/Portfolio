<% name = params[:trigger] == "function" ? "Function" : "Task" %>
<%= meta_title "My #{name.pluralize}", include_name: false %>

<div class="skinny-container lists-index-container">
  <div class="btn-container">
    <a href="<%= account_path %>" class="btn">Account</a>
    <% if params[:trigger] == "function" %>
      <a href="<%= new_jil_jarvis_task_path(trigger: :function) %>" class="btn pull-right">New Function +</a>
    <% else %>
      <a href="<%= new_jil_jarvis_task_path %>" class="btn pull-right">New Task +</a>
    <% end %>
  </div>
  <div class="lists-title">My <%= name.pluralize %></div>
  <% if params[:trigger] == "function" %>
    <%= link_to "Tasks", jil_path, class: "btn pull-right" %>
  <% else %>
    <%= link_to "Custom Functions", jil_path(trigger: :function), class: "btn pull-right" %>
  <% end %>
  <div class="lists">
    <div class="list-field">
      <%= text_field_tag "task[name]", "", class: "filterable", placeholder: "Search #{name.downcase}s" %>
    </div>
    <div class="important-list-items"></div>

    <% @tasks.each do |task| %>
      <div class="list-item-container" data-list-id="<%= task.uuid %>">
        <div class="list-item-config">
          <%= content_tag :div, task.humanized_schedule, class: "category" %>
          <%= content_tag :div, :Disabled, class: "status disabled" if !task.enabled? %>
        </div>
        <div class="list-item-handle"><i class="fa fa-ellipsis-v"></i></div>
        <a href="<%= edit_jil_jarvis_task_path(task) %>" class="list-item">
          <span class="item-name"><%= task.name.titleize %></span>
        </a>
        <div class="list-item-brief">
          <div class="left-brief">
            <% if task.last_trigger_at.present? %>
              <%= task.last_trigger_at.in_time_zone(current_user.timezone)&.to_formatted_s(:compact_week_month_time).gsub(":00 ", "") %>
              (<%= relative_time_in_words(task.last_trigger_at) %>)
            <% else %>
              --Never Run--
            <% end %>
          </div>
          <div class="right-brief">
            <% if task.next_trigger_at.present? %>
              <%= task.next_trigger_at.in_time_zone(current_user.timezone)&.to_formatted_s(:compact_week_month_time).gsub(":00 ", "") %>
              (<%= relative_time_in_words(task.next_trigger_at) %>)
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
