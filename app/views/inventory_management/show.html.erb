<% level ||= 0 %>
<% content_for :title, "Inventory" %>

<div class="inventory-wrapper">
  <div class="search-wrapper">
    <div class="current">
      <span>Adding to: <code class="hierarchy">Everything</code></span>
      <button type="button" class="edit-button" disabled data-modal="edit-modal">Edit</button>
    </div>
    <%= form_with(url: :inventory, html: { class: "basic inventory-inline-form" }) do |f| %>
      <%= f.hidden_field :parent_id, id: :new_box_parent_id %>
      <%= f.text_field :name, placeholder: "Search | Add Items", id: :new_box_name %>
      <%= f.submit "Add" %>
      <template id="box-template">
        <%= render partial: "inventory_management/box", locals: { box: Box.new } %>
      </template>
    <% end %>
  </div>

  <div class="tree">
    <ul role="tree" aria-label="Inventory Tree">
      <li data-type="root" data-id="" data-hierarchy="Everything">
        <div class="root-wrapper">
          <% if @crumbs.nil? %>
            Everything
          <% else %>
            <%= link_to "Everything", inventory_path %>
            <% @crumbs&.each do |crumb| %>
              <span class="crumb">&gt; <%= link_to crumb[:name], box_path(crumb[:id]) %></span>
            <% end %>
          <% end %>
        </div>
      </li>
      <% @boxes.each do |box| %>
        <%= render partial: "inventory_management/box", locals: { box: box } %>
      <% end %>
    </ul>
  </div>
</div>

<% content_for :modals do %>
  <div class="modal widget-modal" id="edit-modal" tabindex="-1">
    <div class="status"></div>
    <div class="close"><i class="ti ti-fa-close"></i></div>
    <div class="modal-content">
      <%= form_with(url: :inventory, method: :patch, local: true, html: { class: "basic inventory-inline-form", id: "editBoxForm" }) do |f| %>
        <div class="copy-url">
          <input readonly class="url" type="text" value="" placeholder="rdjn.me/b/:id">
        </div>
        <%= f.hidden_field :box_id %>
        <%#= f.hidden_field :parent_id %>
        <%= f.text_field :name, placeholder: "Item Name" %>
        <%= f.text_field :notes, placeholder: "Quick Notes" %>
        <%= f.text_area :description, placeholder: "Description" %>

        <div class="text-right">
          <%= f.submit "Update" %>
        </div>
      <% end %>
      <div class="modal-footer">
        <div class="text-right">
          <button type="button" class="delete-button danger">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <div id="edit-modal" class="modal" aria-hidden="true">
    <div class="sheet">
      <h3 id="modalTitle">Edit</h3>
      <form id="editForm">
        <input type="hidden" name="id" />
        <input type="hidden" name="kind" />
        <div class="form-row">
          <label>Name</label>
          <input name="name" required />
        </div>
        <div class="form-row">
          <label>Description</label>
          <textarea name="description" rows="3"></textarea>
        </div>
        <div class="form-row">
          <label>Notes</label>
          <textarea name="notes" rows="3"></textarea>
        </div>
        <div class="form-row">
          <label>Tags (comma separated)</label>
          <input name="tags" />
        </div>
        <div class="form-row">
          <label>Data (JSON)</label>
          <textarea name="data" rows="6" placeholder='{"key":"value"}'></textarea>
        </div>
        <div class="actions">
          <button type="button" id="cancelEdit">Cancel</button>
          <button type="submit" id="saveEdit">Save</button>
        </div>
      </form>
    </div>
  </div>
<% end %>
