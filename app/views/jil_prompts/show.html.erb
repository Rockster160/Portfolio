<%= meta_title @prompt.question, include_name: false %>
<%= meta_description @prompt.question  %>

<%= form_for @prompt, html: { class: "basic" } do |f| %>
  <div class="skinny-container lists-index-container">
    <div class="lists-title instructions"><%= @prompt.question %></div>
    <div class="list-items survey-questions">
      <% @prompt.options&.each do |option_key, option_val| %>
        <% base_key = "prompt[response][#{option_key}]" %>
        <p class="text-center"><%= option_key %></p>
        <% if option_val.is_a?(String) %>
          <%= text_field_tag option_key, @prompt.response&.dig(option_key), placeholder: option_val %>
        <% elsif option_val.is_a?(Integer) %>
          <%=
            content_tag(
              :input,
              @prompt.response&.dig(option_key),
              type: :range,
              name: base_key,
              min: 0,
              max: option_val,
              class: "list-item-range",
            )
          %>
        <% elsif [TrueClass, FalseClass].include?(option_val.class) %>
          <div class="list-item-container">
            <%= hidden_field_tag base_key, false %>
            <%=
              content_tag :input, "", {
                type: :checkbox,
                id: base_key,
                name: base_key,
                value: true,
                class: "list-item-checkbox",
                checked: @prompt.response&.dig(option_key)&.include?(option),
              }
            %>
            <label for="<%= base_key %>" class="list-item">
              <div class="checkbox-wrapper"></div>
              <div class="item-name">
                <%= option_key %>
              </div>
            </label>
          </div>
        <% elsif option_val.is_a?(Array) %>
          <% option_val.each_with_index do |option, idx| %>
            <% base_params = "#{base_key}[]" %>
            <% id = "#{base_params}#{idx}".gsub(/[^\w]/, "") %>
            <div class="list-item-container">
              <%=
                content_tag :input, "", {
                  type: :checkbox,
                  id: id,
                  name: "#{base_params}",
                  value: option,
                  class: "list-item-checkbox",
                  checked: @prompt.response&.dig(option_key)&.include?(option),
                }
              %>
              <label for="<%= id %>" class="list-item">
                <div class="checkbox-wrapper"></div>
                <div class="item-name">
                  <%= option %>
                </div>
              </label>
            </div>
          <% end %>
        <% else %>
          Unknown: <%= option_val.class %> (<%= option_val.inspect %>)
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="skinny-container">
    <div class="text-center">
      <%= f.submit "Submit", class: "wide" %>
      <br>
      <br>
      <br>
    </div>
  </div>
<% end %>
